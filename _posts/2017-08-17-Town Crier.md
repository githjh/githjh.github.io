---
layout: post
title: Town Crier
categories: others
---

### 초록

스마트 컨트랙트은 블록 체인에서 자율적으로 실행되는 프로그램이다. 그들의 주요 용도 (예 : 금융 상품)는 블록 체인 외부의 데이터 (예 : 주식 시세)를 사용해야 한다. 따라서 광범위한 데이터 요청을 지원하는 신뢰할 수있는 데이터 피드가 스마트 컨트렉트 생태계에 중요하다. 

Town Crier (TC)라는 인증 된 데이터 피드 시스템을 제시한다. TC는 현명한 계약과 기존 웹 사이트 간의 다리 역할을 한다.이 웹 사이트는 이미 비 블록 체인 응용 프로그램에 대해 일반적으로 신뢰 받고 있다. 블록 체인 프론트 엔드와 신뢰할 수있는 하드웨어 백엔드를 결합하여 HTTPS 지원 웹 사이트에서 정보를 가져와 원본 인증 데이터를 신뢰할 수 있는 스마트 컨트렉트에 제공한다. 

TC는 기밀성도 지원합니다. 암호화 된 매개 변수로 개인 데이터 요청을 가능하게 한다. 또한 TC 내에서 스마트 계약 논리를 실행하는 일반화에서 시스템은 액세스 제어 온라인 데이터 소스를 긁어 내기 위해 사용자 자격 증명의 안전한 사용을 허용한다. 

우리는 TC의 설계 원칙과 아키텍처에 대해 설명하고 최근 도입 된 Intel SGX (Software Guard Extensions)를 사용하여 Ethereum 스마트 계약 시스템에 데이터를 제공하는 구현에 대해보고 한다. 우리는 공식적으로 TC를 모델링하고 UC (Universal Composibility) 프레임 워크에서 기본 보안 속성을 정의하고 증명한다. 우리의 결과에는 자원 소비 (Ethereum의 "가스"요금 시스템) 및 TCB 최소화와 관련된 일반 정의 및 기술이 포함된다. 또한 세 가지 예제 응용 프로그램을 사용하여 실험을 수행한다. 우리는 온라인 공무원으로 곧 TC를 시작할 계획이다.

### 인트로


스마트 계약은 자발적으로 계약 조건을 실행하는 컴퓨터 프로그램이다. 수십 년 동안 그들은 법률 계약을보다 정확하고 보급 적이며 효율적으로 실행할 수있는 방법으로 계획되었다.  세미날 1994 년 에세이 [36]에서 "스마트 계약"이라는 용어를 대중화 한 Szabo는 자동차 대출 지불을 시행하는 똑똑한 계약을 모범으로 제시했다. 자동차 소유자가시기 적절한 지불을하지 못하면 스마트 계약서를 통해 프로그래밍 방식으로 물리적 액세스를 철회하고 자동차를 은행에 반환 할 수 있다.
 
비트 코인 (Bitcoin)과 같은 암호화폐 (Cryptocurrencies) [30]는 스마트 계약을위한 핵심 기술 토대를 제공한다. 프로그램에 의한 직접적인 통제와 블록 체인의 기본이되는 분산 된 합의 메커니즘을 통한 공정하고 자동화 된 코드 실행한다. 최근에 출시 된 Ethereum [14,38]은 Turing 전체 코드를 지원하므로 완전히 표현 된 자기 집행 형 분산 스마트 계약을 지원하므로 연구자와 지지자의 비전을 향한 커다란 발걸음을 내디뎠다. 그러나 Szabo의 사례에서 볼 수 있듯이 금융 상품과 같은 스마트 계약의 가장 강력한 응용 프로그램은 실제 세계의 주 및 이벤트에 대한 데이터에 대한 액세스가 추가적으로 필요하다.
 
데이터 피드 ( 'oracles'라고도 함)는 이러한 필요를 충족시키는 데 목적이 있다. 간단히 말해서, 데이터 피드는 다른 계약에 의한 데이터 요청을 처리하는 블록 체인의 컨트렉트들이다[14, 38]. 현재 Ethereum의 데이터 피드는 신뢰할 수있는 웹 사이트의 데이터를 제공하지만 운영자 (일반적으로 개인 또는 소기업)의 명성을 넘어서는 데이터를 올바르게 중계하지는 못한다. 신뢰할 수있는 웹 사이트에 대한 HTTPS 연결은 솔루션을 제공하는 것처럼 보일 수 있지만 스마트 계약은 네트워크 액세스가 부족하며 HTTPS는 대역 외 인증을 위해 데이터에 디지털 서명을하지 않는다. 신뢰할 수있는 데이터 피드의 실질적인 생태계의 부족은 일반적으로 Ethereum과 분산 된 스마트 계약의 진화에 중요한 장애물로 인용된다 [21].


타운 크라이어. 

우리는 스마트 계약에 대해 인증 된 데이터 피드 (ADF)를 제공함으로써이 문제를 해결하는 Town Crier (TC)라는 시스템을 소개한다. TC는 기존의 HTTPS 지원 데이터 웹 사이트와 Ethereum 블록 체인 간의 상호 연결 역할을 한다. 웹 사이트 데이터를 검색하고이를 블록 체인에 의존하는 계약에 데이터 그램이라고하는 간결한 데이터 (예 : 주식 시세)로 제공 한다. TC는 SGX (Software Guard Extensions), Intel의 최근에 출시 된 신뢰할 수있는 하드웨어 기능 및 현명한 계약 프런트 엔드의 새로운 조합을 사용한다. SGX는 SGX 영역에서 신뢰할 수있는 코드로 핵심 기능을 실행한다. SGX 영역은 악의적인 프로세스 및 OS로부터 보호하며 클라이언트가 합법적인 SGX 지원 TC 인스턴스와 상호 작용하는 원격 클라이언트를 증명할 수 있다.
 
Town Crier의 현명한 계약 프론트 엔드는 다음과 같은 형식의 증명과 함께 블록 체인의 계약 요청에 응답한다. 

"매개 변수 params로 지정된 데이터 그램 X는 지정된 시간 프레임 T 동안 HTTPS 지원 웹 사이트 Y가 제공한다." 

컨트랙트를 신뢰하는 것은 SGX의 보안, (게시 된) TC 코드 및 지정된 시간 간격의 소스 데이터의 유효성 만 신뢰한다고 가정 할 때 이러한 데이터 그램에서 X의 정확성을 확인할 수 있다. 

영리 계약 채택의 또 다른 중요한 장벽은 오늘날의 생태계에서 기밀 유지가 부족하다는 것이다. 모든 블록 체인 상태가 공개적으로 표시되며 기존 데이터 피드가 공개적으로 요청을 노출한다. TC는 개인 데이터 그램 요청을 지원하여 기밀성을 제공한다. 이 매개 변수는 TC의 SGX 영역에서의 처리를 위해 TC 공개 키에 따라 암호화되므로 블록 체인에서 숨겨 진다. 또한 TC는 암호화 된 사용자 자격 증명을 수집하여 요청자 (예 : 온라인 계정)의 온라인 리소스에 안전하게 액세스하여 TC가 액세스 제어 데이터를 안전하게 검색 할 수 있도록하는 맞춤 데이터 그램 요청을 지원 한다. 

우리는 TC를 암호화 프로토콜 수준에서 정식 보안 보장을 제공하는 완벽하고 확장 성이 뛰어난 엔드 투 엔드 시스템으로 설계하고 구현했다. TC는 에뮬레이터 (예 : [10,33])와는 달리 실제 SGX 지원 호스트에서 실행됩니다. 우리는 SGX 인증을 확인하는 데 필요한 Intel 인증 서비스 (IAS)가 곧 출시 될 때까지 Ethereum 위에 TC의 오픈 소스 생산 서비스로 TC 버전을 출시 할 계획이다.

기술적 어려움. 

스마트 계약은 당사자가 의존하는 계약이나 서비스를 전복함으로써 경제적 이득을 얻을 수있는 적대적인 환경에서 실행된다. 따라서 공식적인 보안은 매우 중요하다. 우리는 Block Cain의 설계에 대한 엄격한 접근법을 Universal Comboability (UC) 프레임 워크에서 모델링하여 [28, 35]를 기반으로 블록 체인 및 신뢰할 수있는 하드웨어에 걸쳐 흥미로운 공식 모델을 구현한다. 우리는 공식적으로 TC가 데이터 그램 진위의 기본 속성을 얻는 것을 비공식적으로 증명한다. 즉, TC가 대상 웹 사이트의 현재 데이터를 충실하게 중계합니다. 즉 우리는 TC 호스트를 악의적이라고하더라도 TC를 호출하는 사용자 계약에 의해 지불 된 요금이 TC 서비스의 운영 비용을 충당하기위한 소액임을 정직한 요청자에게 공정한 지출을 입증한다.

 SGX와 블록 체인의 결합으로 생성 된 새로운 TCB 모델 내에서 가스 지속 가능성 및 TCB (Trusted Computing Base) 코드 최소화라는 두 가지 주요 보안 속성을 달성하는 방법을 소개하고 보여준다. 

Ethereum에는 분산 코드 실행에 대한 높은 리소스 비용과 응용 프로그램 계층 서비스 거부 (DoS) 공격의 위험으로 인해 실행 비용을 지불하는 gas라는 회계 자원이 포함됩니다. 비공식적으로, 가스 지속 가능성은 Ethereum 서비스가 가스, 일반 및 기본 가용성 속성을 모두 소모하지 않음을 의미합니다. 우리는 Ethereum 서비스에 적용 할 수있는 가스 지속 가능성에 대한 공식 정의를 내리고 TC가이를 만족 시킨다는 것을 증명한다.

 SGX와 SGX를 결합한 블록 체인은 스마트 계약 시스템의 기밀성을 확보하고 오프 체인 시스템과 네트워크를 형성하는 강력하고 일반적인 방법으로 입증 될 것이다. 그러나이 새로운 보안 패러다임은 다른 신뢰 모델을 사용하여 구성 요소에 걸쳐있는 하이브리드 화 된 TCB를 도입합니다. TCB 코드 크기를 최소화하면서 이러한 혼성화 된 TCB를 안전하게 사용하는 기술을 소개합니다. TC에서는 블록 체인에서 영토로의 인증 된 채널을 구성하는 것을 피하는 방법을 보여줍니다. 대신 Ethereum 클라이언트를 사용하여 영토를 부풀게하는 방법을 보여줍니다. 대신 블록 체인에있는 영토 출력을 인증합니다. 또한 onchain 서명 확인 코드를 최소화하는 방법을 보여줍니다. 이러한 기술은 일반적입니다. 유사한 hybrid TCB의 사용에도 적용됩니다. 다른 흥미로운 작은 도전 과제는 TC 설계에서 발생합니다. 하나는 영토 내에 TLS를 배치하는 것입니다. 영토는 네트워킹 기능이 부족하므로 TLS 코드를 고립 된 호스트 환경과 신뢰할 수없는 호스트 환경 사이에 신중하게 분할해야합니다. 다른 하나는 웹 사이트 또는 단일 SGX 인스턴스의 손상 위험으로부터 TC를 헤지하고 있습니다. 동일한 형태의 데이터 (예 : 주가)를 제공하는 여러 웹 사이트 또는 여러 SGX 플랫폼 중 다수에서 여러 가지 투표 방식으로 달성합니다.


응용 프로그램 및 성능. 

우리는 TC가 기존의 Ethereum 에코 시스템에서 실현하기 어려운 다양한 스마트 계약 전개를 촉진 할 수 있다고 믿는다. 우리는 TC의 기능을 보여주는 세 가지 예제를 탐색합니다. (1) 주식 시세 데이터를 사용하는 금융 파생 상품 (현금 결제 형 옵션). (2) 비행 취소에 관한 개인 정보 요청에 의존하는 비행 보험 계약; (3) 사용자 계정에 액세스하기 위해 맞춤형 데이터 요청을 사용하여 Ether, Ethereum 통화에 대한 가상 상품 및 온라인 게임 (Steam Marketplace 경유) 판매 계약. 

이 세 가지 응용 프로그램에 대한 우리의 실험은 TC가 확장 성이 뛰어나다는 것을 보여준다. 단일 SGX 호스트에서 실행되는 TC는 15-65 tx / sec의 처리량을 달성한다. 서로 다른 TC 호스트가 상호 의존성이없는 요청을 처리 할 수 있으므로 TC는 많은 호스트에서 쉽게 병렬 처리된다. (비교를 위해, Ethereum은 현재 1 tx / sec 이하를 처리하고 최근의 연구 [19]는 Bitcoin이 reparametrization없이 더 이상 26 tx / sec로 안전하게 확장 할 수 없음을 시사합니다.) 이러한 동일한 어플리케이션의 경우, 데이터 그램 요청의 실험 응답 시간은 192 -1309 ms - Ethereum 블록 간격 (평균 12 초)보다 훨씬 적습니다. 이러한 결과는 SGX를 사용하는 소수의 호스트가 최신 분산 블록 체인의 글로벌 트랜잭션 속도를 훨씬 능가하는 TC 데이터 공급 속도를 지원할 수 있음을 나타낸다.

기여한 것들. 우리는 다음과 같은 공헌을 제공합니다 :

• 분산 스마트 계약의 채택에 대한 중요한 장벽을 해결하는 인증 된 데이터 공급 시스템 인 Town Crier의 종단 간 구현에 대해 소개하고보고합니다. TC는 Ethereum의 스마 계약 프론트 엔드와 SGX 기반의 신뢰할 수있는 하드웨어 백엔드를 결합하여 (1) 신뢰할 수있는 서비스 운영자없이 인증 된 데이터를 스마트 계약에 제공하고 (2) 개인 및 사용자 정의 데이터 요청을 지원하여 암호화 된 요청 및 오프 액세스 데이터 소스를 안전하게 사용합니다. 곧 오픈 소스 서비스로 TC 버전을 출시 할 계획입니다.

• 우리는 UC (Universal Composability) 프레임 워크 내에서 TC의 보안을 공식적으로 분석하여 온 체인 및 오프 체인 구성 요소를 나타내는 기능을 정의합니다. 우리는 정식으로 데이터 그램의 신뢰성과 공정한 지출은 물론 Ethereum 서비스의 근본적인 가용성 속성 인 가스 지속 가능성을 정의하고 증명합니다. 

• 신뢰할 수있는 시스템 구성의 강력한 새로운 패러다임 인 블록 체인과 SGX 영역에 걸친 하이브리드 화 된 TCB를 소개합니다. 이 모델 내에서 TCB 코드 크기를 줄이는 데 도움이되는 일반적인 기술과 개별 SGX 플랫폼 손상을 헤지하기위한 기술을 제시합니다.

• 우리는 Ethereum보다 훨씬 다양한 범위의 서비스를 지원하는 TC의 능력을 보여주는 세 가지 TC 애플리케이션을 탐구합니다. 이러한 애플리케이션을 사용한 실험을 통해 TC는 최신 분산 블록 체인의 대기 시간 및 처리량 요구 사항을 쉽게 충족 할 수 있음을 보여줍니다.

### 2. 배경지식

스마트 계약. 기술위원회는 원칙적으로 스마트 계약 시스템을 지원할 수 있지만 우리는이 모델에서 설명 할 모델 인 Ethereum에서의 사용에 초점을 맞 춥니 다. 자세한 내용은 [14, 38]을 참조하십시오.

Ethereum의 현명한 계약은 스마트 어카운트라고 불리는 코드, 통화 잔액 및 키 / 값 저장소 형식의 영구 메모리로 표현 된다. 계약은 다양하게 디자인된 함수의 입력 메세지를 허용한다. 계약 생성자가 결정한 이러한 진입 점은 계약 API를 나타낸다. 생성 된 계약은 자율적으로 실행된다. 계약은 만든사람도 코드를 수정하는 것은 불가능하다. 계약 코드는 다른 계약의 메시지 수신 또는 비 계약 (외부 소유) 계정의 트랜잭션 수신, 비공식적 인 지갑 호출에 대한 응답으로 실행된다. 따라서 계약 실행은 항상 트랜잭션에 의해 시작된다. 비공식적으로 계약은 "poked"때만 계약이 실행되며 더 이상의 메시지 전달이 발생하지 않을 때까지 (또는 아래에 설명 된 것처럼 가스 부족이 발생할 때까지) 일련의 진입 점을 통해 poking이 진행된다. 단순한 추상화로서의 "poking"모델은 제쳐두고 똑똑한 계약은 블록 체인에서 자율적 인 에이전트로 간주 될 수 있다.

 Ethereum에는 Ether이라고하는 고유 한 암호 화폐가 있다. (글을 쓰고 있는 시점에서 1 Ether은 시장 가격이 미화 15 달러 미만이다 [1].) DoS 공격을 방지하고 계약 내 실수로 무한 루프를 방지하고 일반적으로 네트워크 자원을 제어하기 위해 Ethereum은 Ether 기반의 계약을 맺기 위해 가스라고 불리는 리소스. 데이터 전송, 계산 실행 및 데이터 저장을 포함한 모든 작업에는 고정 된 가스 비용이 있습니다. 거래에는 그들이 시작한 계산에 의해 소모 된 가스의 양에 대한 경계를 지정하는 매개 변수 (GASLIMIT)가 포함됩니다. 함수가 다른 함수를 호출 할 때 선택적으로 상위 호출과 동일한 풀에서 가스를 소비하는 하위 호출에 대해 더 낮은 GASLIMIT를 지정할 수 있습니다. 가스 부족으로 인해 기능이 완료되지 않으면 중단되고 부분 계산에 의해 유도 된 모든 상태 변화가 사전 호출 상태로 롤백됩니다. 통화 경로의 이전 계산은 유지되지만 가스는 계속 소비됩니다. 

GASLIMIT와 함께, 거래는 GASPRICE를 지정합니다. 이는 거래가 가스 단위당 지불하고자하는 최대 금액입니다. 따라서 시작 계정의 잔액이 GASLIMIT × GASPRICE 이더이고 GASPRICE가 시스템 (광부)이 충분히 높을 경우에만 트랜잭션이 성공합니다. 5.1 절에서 논의하는 것처럼, 가스 관리는 악의적 인 사용자 앞에서 TC (및 기타 Ethereum 기반 서비스)의 가용성에 중요합니다. 마지막으로 Ethereum의 트랜잭션은 ECDSA를 사용하여 Secp256k1 곡선과 해시 함수 SHA3-256을 사용하여 지갑에 디지털 서명됩니다.

### 3. 아키텍처

TC 계약 CTC.

TC 계약은 TC의 블록 체인 프론트 엔드 역할을하는 현명한 계약입니다. TC에 대한 요청을 위해 의존 계약 CU에 간단한 API를 제공하도록 설계되었습니다. CTC는 CU로부터 데이터 그램 요청을 받아들이고 TC에서 해당 데이터 그램을 반환합니다. 또한 CTC는 TC의 금전적 자원을 관리합니다.

enclave

  우리는 단순히 SGX 영역에서 영토로 실행되는 TC 코드의 인스턴스를 참조하고 progencl을 사용하여 코드 자체를 나타냅니다. TC에서는 차단 장치가 블록 체인의 데이터 그램 요청을 처리하고 수행합니다. 데이터 그램에 포함 할 데이터를 얻기 위해 외부 데이터 소스, 특히 HTTPS 지원 인터넷 서비스를 쿼리합니다. 디지털 서명 된 블록 체인 메시지로 요청한 계약 CU에 데이터 그램을 반환합니다. Enclave는 SGX의 기본 보안 모델 인 네트워크 기능을 제외하고 호스트의 다른 프로세스는 물론 적대적인 OS와는 완전히 분리되어 실행됩니다.

The Relay R. 

SGX 고립 구역 과정으로서 영토는 직접적인 네트워크 접근이 부족하다. 따라서 릴레이는 영토를 대신하여 양방향 네트워크 트래픽을 처리합니다. 특히, 릴레이는 엔 클레이브에서 세 가지 유형의 엔티티로 네트워크 연결을 제공합니다. 

1. 블록 체인 (에테 리엄 시스템) : 릴레이는 CTC의 상태를 모니터링하기 위해 블록 체인을 긁습니다. 이 방법에서는 구성 요소 자체가 네트워크 연결을 가지지 않으므로 CTC에서 고립 된 메시지 전달을 수행합니다. 또한 Relay는 고립 된 블록 (데이터 그램)에서 방출 된 메시지를 블록 체인에 배치합니다. 

2. 클라이언트 : 릴레이는 웹 서버를 실행하여 고객으로부터의 오프 - 체인 서비스 요청을 처리합니다. 특히 영토 보완 요청에 대한 요청입니다. 우리가 곧 설명 하겠지만, 증명은 클라이언트에게 영토 엔 클레이브 인스턴스에 대한 고유 한 공개 키를 제공하고 영토가 SGX 영토에서 올바른 코드를 실행하고 있으며 시계가 절대 (월 - 클럭) 시간면에서 정확하다는 것을 증명합니다. 증명을 성공적으로 검증 한 클라이언트는 TC를 사용하는 신뢰할 수있는 계약 CU를 안전하게 작성할 수 있습니다. 

3. 데이터 소스 : 릴레이는 데이터 소스 (HTTPS 지원 웹 사이트)와 영토 간 트래픽을 릴레이합니다.

Relay는 일반 사용자 공간 응용 프로그램입니다. 그것은 SGX에 의한 무결성 보호로부터 이익을 얻지 못하기 때문에 영토와는 달리 TC 서버상의 적대적인 OS에 의해 망가져 지연이나 실패를 유발할 수 있습니다. 그러나 TC의 주요 설계 목표는 릴레이가 잘못된 데이터 그램을 생성 할 수 없거나 사용자가 데이터 그램에 대해 TC에게 지불 한 수수료를 잃지 않아야한다는 것입니다 (요청을 실행하는 데 가스를 사용하지 않을 수도 있음). 우리가 보여 주겠지만, 일반적으로 릴레이는 TC에 대한 서비스 거부 공격 만 마운트 할 수 있습니다

보안 모델. 여기에서는 TC에 대한 보안 모델에 대해 간단히 설명하고 이후 섹션에서 자세한 내용을 제공합니다. 우리는 다음을 가정합니다.

• TC 계약. CTC는 블록 체인에서 전 세계적으로 볼 수 있으며 소스 코드는 클라이언트 용으로 게시됩니다. 따라서 우리는 CTC가 정직하게 행동한다고 ​​가정합니다.

• 데이터 소스. 우리는 클라이언트가 TC 데이터 그램을 얻는 데이터 소스를 신뢰한다고 가정합니다. 또한, 요청자의 특정 시간 간격 T 동안 이러한 소스가 안정적이며, 즉 일관된 데이터 그램을 산출한다고 가정한다 (요청은 일반적으로 특정 시간의 주가와 같이 시간 불변이다).

• 영토 보안. 우리는 다음 세 가지 가정을합니다. (1) 영토가 정직하게 행동합니다. 즉, 소스 코드가 클라이언트 용으로 게시 된 progencl이 프로토콜을 올바르게 실행합니다. (2) 고립 된 키 쌍 (skTC, pkTC)의 경우, 개인 키 skTC는 고립 된 영토에만 알려져 있습니다. (3) 영토에는 정확한 (내부) 실시간 시계가 있습니다. SGX를 ​​사용하여 이러한 속성을 얻는 방법은 아래에서 설명합니다.

• 블록 체인 통신. 트랜잭션 및 메시지 소스는 인증이 가능합니다. 즉, 지갑 WX (또는 계약 CX의 메시지 m)에서 수신 된 거래는 수신 계정에서 X에서 발생한 것으로 식별됩니다. 거래 및 메시지는 발신자가 디지털 서명을하여 무결성을 보장받습니다 ), 기밀은 아닙니다.

• 네트워크 통신. Relay (및 TC 서버의 다른 신뢰할 수없는 구성 요소)는 Enclave와의 통신을 방해하거나 지연시킬 수 있습니다. SGX 보안 모델에서 설명했듯이, 릴레이는 영원의 행동을 관찰하거나 변경할 수 없습니다. 따라서 릴레이는 네트워크를 제어하는 ​​적에게 포섭됩니다.
